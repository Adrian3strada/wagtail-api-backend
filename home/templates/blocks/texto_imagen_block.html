{% load wagtailcore_tags %}
{% load wagtailimages_tags %}

<div class="bloque-imagen-texto posicion-{{ self.posicion_imagen }}">

    {% if self.titulo %}
    <h2 class="bloque-titulo text-center">{{ self.titulo|richtext }}</h2>
    {% endif %}

    {# Fondo o Herobanner con imagen #}
    {% if self.posicion_imagen == "fondo" or self.posicion_imagen == "herobanner" %}
    {% with imagen=self.imagenes.0 %}
    {% if imagen %}
    <div class="bloque-fondo d-flex align-items-center justify-content-center">
        <div class="bloque-overlay">
            <div class="bloque-texto fondo-texto" style="text-align: {{ self.texto.alineacion }};">
                {{ self.texto.texto|richtext }}
            </div>
        </div>
        <div class="bloque-fondo-img" style="background-image: url('{{ imagen.url }}');"></div>
    </div>
    {% endif %}
    {% endwith %}

    {% elif self.posicion_imagen == "izquierda" or self.posicion_imagen == "derecha" %}
    <div class="bloque-contenido row align-items-center">
        {% with imagen=self.imagenes.0 %}
        {% if self.posicion_imagen == "izquierda" and imagen %}
        <div class="col-md-6 bloque-imagen">
            {% image imagen original class="img-fluid rounded shadow" %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="col-md-6 bloque-texto" style="text-align: {{ self.texto.alineacion }};">
            {{ self.texto.texto|richtext }}
        </div>

        {% with imagen=self.imagenes.0 %}
        {% if self.posicion_imagen == "derecha" and imagen %}
        <div class="col-md-6 bloque-imagen">
            {% image imagen original class="img-fluid rounded shadow" %}
        </div>
        {% endif %}
        {% endwith %}
    </div>

    {% elif self.posicion_imagen == "abajo" %}
    <div class="bloque-texto mb-3" style="text-align: {{ self.texto.alineacion }};">
        {{ self.texto.texto|richtext }}
    </div>
    {% with imagen=self.imagenes.0 %}
    {% if imagen %}
    <div class="bloque-imagen text-center">
        {% image imagen original class="img-fluid rounded shadow" %}
    </div>
    {% else %}
    <p style="color:red">No hay imagen asignada</p>
    {% endif %}
    {% endwith %}

    {% elif self.posicion_imagen == "galeria" %}
    <div class="bloque-texto mb-3" style="text-align: {{ self.texto.alineacion }};">
        {{ self.texto.texto|richtext }}
    </div>
    {% if self.imagenes %}
    <div class="bloque-galeria d-flex flex-wrap gap-3 justify-content-center">
        {% for img in self.imagenes %}
        <div class="galeria-item">
            {% image img fill-400x300 class="img-fluid rounded shadow-sm" %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endif %}
</div>

<style>
    .bloque-titulo {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #0A1A42;
    }

    .bloque-fondo {
        position: relative;
        min-height: 300px;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 2rem;
    }

    .bloque-fondo-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        filter: brightness(0.6);
    }

    .bloque-overlay {
        position: relative;
        z-index: 2;
        padding: 4rem 2rem;
        color: white;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
        text-align: center;
    }

    .bloque-contenido {
        margin-bottom: 2rem;
    }

    .bloque-texto {
        font-size: 1.1rem;
        line-height: 1.6;
        color: #333;
    }

    .bloque-galeria .galeria-item {
        flex: 0 0 auto;
        width: 250px;
    }
</style>